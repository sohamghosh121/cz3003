{% load staticfiles %}
<!DOCTYPE html>
<html lang="en">
<head>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
	<script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
	<link rel="stylesheet" href="{% static 'bootstrap/css/bootstrap.css' %}">
	<style>
		ol li{
			font-size: 200%;
		}
		ul li{
			font-size: 100%;
		}	
	</style>
</head>

<body>
	<!--<script> -->
<!-- 	// 	$.ajax({ -->
<!-- 	// 		url: 'getMapImage',
	// 		async: false
	// 	}); -->
	<!--</script>-->
	<script>
		var map = document.getElementById("map");
		var iconBase = '/static/img/';
        var weatherMarkers = "markers=icon:";
        var dengueMarkers = "markers=icon:";
        var eventMarkers = "markers=icon:";
		$.ajax({
	    		url: 'getEventsGeoJSON',
	    		data: {},
	    		dataType: 'json',
	    		async: false;
	    	}).done(function(eventData, textStatus, jqXHR) {
	    		addIcons(eventData);              
	    	}).fail(function(){
	    		console.log('failed'); // some proper failure message
	    	});
	        
        $.ajax({
                url: '/getWeatherInfo',
                dataType: 'json',
                async: false
            }).done(function (weatherData) {
            	addIcons(weatherData);
            });

        $.ajax({
                url: '/getDengueInfo',
                dataType: 'json',
                async: false
            }).done(function (dengueData) {
            	addIcons(dengueData);
        });

        function addIcons(data){
        	var feature = data.feature;
        	var type = feature.getProperty('type');
        	if (type == 'weather') {
        		var weatherIcon = iconBase + feature.getProperty('icon');
        		weatherMarkers += weatherIcon;
        	}else if (type == 'dengue'){
        		var dengueIcon = iconBase + feature.getProperty('icon');
        		dengueMarkers += dengueIcon;
        	}else if(type == 'traffic' || type == 'terrorist'){
        		var eventIcon = iconBase + feature.getProperty('icon');
        		eventMarkers += eventIcon;
        	}
        }    
	</script>
	<h1 style="text-align:center;" ><b>Automatically generated report by CMS System</b></h1>
	<ol>
		<li id='time'></li>
		<li id='map'><b>Map information:</b></li>
		<img id="map" src="https://maps.googleapis.com/maps/api/staticmap?center=Singapore&size=640x640&maptype=roadmap&zoom=11&key=AIzaSyBhT6uGESFhrvcUxK76iQzr90H6x-d1OLs" width="640">

<!-- 		style=element:labels|visibility:off&style=element:geometry.stroke|visibility:off&style=feature:landscape|element:geometry|saturation:-100&style=feature:water|saturation:-100|invert_lightness:true -->
		<li><b>Traffic accidents:</b>
			<ul>
				<li id='accidents'></li>
				<li id='vehicles'></li>
				<li id='traffic-casualties'></li>
				<li id='traffic-injuries'></li>
				<li id='traffic-locations'></li>
			</ul>
		</li>
		<li><b>Terrorist attacks:</b>
			<ul>
				<li id='attacks'></li>
				<li id='hostiles'></li>
				<li id='terrorist-casualties'></li>
				<li id='terrorist-injuries'></li>
				<li id='terrorist-locations'></li>
				<li id='terrorist-types'></li>
			</ul>
		</li>
		<li><b>Crisis level:</b></li>
	</ol>
	<script src="{% static 'js/report.js' %}"></script>
</body>